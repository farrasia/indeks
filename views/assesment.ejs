<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Assessment - LB3 Emergency Preparedness</title>
  <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
  <style> .criteria-row { border-bottom:1px solid #eee; padding:10px 0; } </style>
</head>
<body class="p-4">
  <div class="container" id="assessment-root" data-categories="<%= encodeURIComponent(JSON.stringify(categories || [])) %>">
    <h3>LB3 Emergency Preparedness Assessment</h3>
    <% if (error && error.length) { %>
      <% error.forEach(function(msg){ %>
        <div class="alert alert-danger"><%= msg %></div>
      <% }) %>
    <% } %>
    <% if (success && success.length) { %>
      <% success.forEach(function(msg){ %>
        <div class="alert alert-success"><%= msg %></div>
      <% }) %>
    <% } %>

    <div class="row mb-3">
      <div class="col-md-4">
        <label for="categorySelect">Category</label>
        <select id="categorySelect" class="form-control"></select>
      </div>
      <div class="col-md-4">
        <label for="aspectSelect">Aspect</label>
        <select id="aspectSelect" class="form-control"></select>
      </div>
    </div>

    <form id="assessmentForm" action="/assessment/submit" method="post">
      <div id="criteriaContainer"></div>
      <div class="mt-3">
        <button class="btn btn-primary" type="submit">Submit Assessment</button>
          <a class="btn btn-secondary ms-2" href="/assessment/history">View History</a>
      </div>
    </form>
  </div>

  <script>
    const categories = JSON.parse(decodeURIComponent(document.getElementById('assessment-root').dataset.categories || '[]'));
    const catSelect = document.getElementById('categorySelect');
    const aspectSelect = document.getElementById('aspectSelect');
    const container = document.getElementById('criteriaContainer');

    function buildCategoryOptions() {
      catSelect.innerHTML = '';
      categories.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c.id; opt.text = c.code + ' - ' + c.name;
        catSelect.appendChild(opt);
      });
    }

    function buildAspectOptions(categoryId) {
      aspectSelect.innerHTML = '';
      const cat = categories.find(c => c.id === parseInt(categoryId));
      if (!cat) return;
      cat.aspects.forEach(a => {
        const opt = document.createElement('option');
        opt.value = a.id; opt.text = a.code + ' - ' + a.name;
        aspectSelect.appendChild(opt);
      });
    }

    function buildCriteria(aspectId) {
      container.innerHTML = '';
      const asp = categories.flatMap(c => c.aspects).find(a => a.id === parseInt(aspectId));
      if (!asp) return;
      asp.criteria.forEach(cr => {
        const div = document.createElement('div');
        div.className = 'criteria-row';
        div.innerHTML = `
          <div class="row">
            <div class="col-md-6">
              <strong>${cr.code}</strong> - ${cr.description}
              <div class="text-muted small">${cr.explanation || ''} (Weight: ${cr.weight})</div>
            </div>
            <div class="col-md-6">
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="answers[${cr.id}]" id="c${cr.id}_1" value="1">
                <label class="form-check-label" for="c${cr.id}_1">Yes</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="answers[${cr.id}]" id="c${cr.id}_0" value="0" checked>
                <label class="form-check-label" for="c${cr.id}_0">No</label>
              </div>
            </div>
          </div>
        `;
        container.appendChild(div);
      });
    }

    catSelect.addEventListener('change', (e) => {
      buildAspectOptions(e.target.value);
      const firstAspect = aspectSelect.options[0];
      if (firstAspect) buildCriteria(firstAspect.value);
    });
    aspectSelect.addEventListener('change', (e) => buildCriteria(e.target.value));

    // init
    buildCategoryOptions();
    if (catSelect.options.length) {
      catSelect.selectedIndex = 0;
      buildAspectOptions(catSelect.value);
      if (aspectSelect.options.length) {
        aspectSelect.selectedIndex = 0;
        buildCriteria(aspectSelect.value);
      }
    }
  </script>
</body>
</html>
<%- include('partials/start') %>
    <div class="row">

        <div class="card">
            <div class="card-header align-items-center d-flex">
                <h4 class="card-title mb-0 flex-grow-1">Recent Orders</h4>
                <div class="flex-shrink-0">
                    <button type="button" class="btn btn-soft-info btn-sm">
                        <i class="ri-file-list-3-line align-middle"></i> Generate Report
                    </button>
                </div>
            </div><!-- end card header -->

            <div class="card-body">
                <div class="table-responsive table-card">
                    <table class="table table-borderless table-centered align-middle table-nowrap mb-0">
                        <thead class="text-muted table-light">
                            <tr>
                                <th scope="col">Order ID</th>
                                <th scope="col">Customer</th>
                                <th scope="col">Product</th>
                                <th scope="col">Amount</th>
                                <th scope="col">Vendor</th>
                                <th scope="col">Status</th>
                                <th scope="col">Rating</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <a href="apps-ecommerce-order-details.html"
                                        class="fw-medium link-primary">#VZ2112</a>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0 me-2">
                                            <img src="assets/images/users/avatar-1.jpg" alt=""
                                                class="avatar-xs rounded-circle" />
                                        </div>
                                        <div class="flex-grow-1">Alex Smith</div>
                                    </div>
                                </td>
                                <td>Clothes</td>
                                <td>
                                    <span class="text-success">$109.00</span>
                                </td>
                                <td>Zoetic Fashion</td>
                                <td>
                                    <span class="badge bg-success-subtle text-success">Paid</span>
                                </td>
                                <td>
                                    <h5 class="fs-14 fw-medium mb-0">5.0<span class="text-muted fs-11 ms-1">(61
                                            votes)</span></h5>
                                </td>
                            </tr><!-- end tr -->
                            <tr>
                                <td>
                                    <a href="apps-ecommerce-order-details.html"
                                        class="fw-medium link-primary">#VZ2111</a>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0 me-2">
                                            <img src="assets/images/users/avatar-2.jpg" alt=""
                                                class="avatar-xs rounded-circle" />
                                        </div>
                                        <div class="flex-grow-1">Jansh Brown</div>
                                    </div>
                                </td>
                                <td>Kitchen Storage</td>
                                <td>
                                    <span class="text-success">$149.00</span>
                                </td>
                                <td>Micro Design</td>
                                <td>
                                    <span class="badge bg-warning-subtle text-warning">Pending</span>
                                </td>
                                <td>
                                    <h5 class="fs-14 fw-medium mb-0">4.5<span class="text-muted fs-11 ms-1">(61
                                            votes)</span></h5>
                                </td>
                            </tr><!-- end tr -->
                            <tr>
                                <td>
                                    <a href="apps-ecommerce-order-details.html"
                                        class="fw-medium link-primary">#VZ2109</a>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0 me-2">
                                            <img src="assets/images/users/avatar-3.jpg" alt=""
                                                class="avatar-xs rounded-circle" />
                                        </div>
                                        <div class="flex-grow-1">Ayaan Bowen</div>
                                    </div>
                                </td>
                                <td>Bike Accessories</td>
                                <td>
                                    <span class="text-success">$215.00</span>
                                </td>
                                <td>Nesta Technologies</td>
                                <td>
                                    <span class="badge bg-success-subtle text-success">Paid</span>
                                </td>
                                <td>
                                    <h5 class="fs-14 fw-medium mb-0">4.9<span class="text-muted fs-11 ms-1">(89
                                            votes)</span></h5>
                                </td>
                            </tr><!-- end tr -->
                            <tr>
                                <td>
                                    <a href="apps-ecommerce-order-details.html"
                                        class="fw-medium link-primary">#VZ2108</a>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0 me-2">
                                            <img src="assets/images/users/avatar-4.jpg" alt=""
                                                class="avatar-xs rounded-circle" />
                                        </div>
                                        <div class="flex-grow-1">Prezy Mark</div>
                                    </div>
                                </td>
                                <td>Furniture</td>
                                <td>
                                    <span class="text-success">$199.00</span>
                                </td>
                                <td>Syntyce Solutions</td>
                                <td>
                                    <span class="badge bg-danger-subtle text-danger">Unpaid</span>
                                </td>
                                <td>
                                    <h5 class="fs-14 fw-medium mb-0">4.3<span class="text-muted fs-11 ms-1">(47
                                            votes)</span></h5>
                                </td>
                            </tr><!-- end tr -->
                            <tr>
                                <td>
                                    <a href="apps-ecommerce-order-details.html"
                                        class="fw-medium link-primary">#VZ2107</a>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0 me-2">
                                            <img src="assets/images/users/avatar-6.jpg" alt=""
                                                class="avatar-xs rounded-circle" />
                                        </div>
                                        <div class="flex-grow-1">Vihan Hudda</div>
                                    </div>
                                </td>
                                <td>Bags and Wallets</td>
                                <td>
                                    <span class="text-success">$330.00</span>
                                </td>
                                <td>iTest Factory</td>
                                <td>
                                    <span class="badge bg-success-subtle text-success">Paid</span>
                                </td>
                                <td>
                                    <h5 class="fs-14 fw-medium mb-0">4.7<span class="text-muted fs-11 ms-1">(161
                                            votes)</span></h5>
                                </td>
                            </tr><!-- end tr -->
                        </tbody><!-- end tbody -->
                    </table><!-- end table -->
                </div>
            </div>
        </div> <!-- .card-->
    </div> <!-- end row-->

    <%- include('partials/end') %>